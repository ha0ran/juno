<!DOCTYPE html>
<html>
    <head>
        <title>JUNO Editor</title>
        <link href="assets/css/bootstrap.min.css" rel="stylesheet">
        <link href="assets/css/editor.css" rel="stylesheet">
    </head>
    <body>
    	<div class="navbar">
            <div class="navbar-inner">
                <a class="brand" href="#">Juno</a> 
                <ul class="nav">
                    <li><a href="#">Home</a></li> 
                    <li><a href="#">Posts</a></li>
                    <li class="active"><a href="#">Editor</a></li>
                </ul> 
            </div>
        </div>
        <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span6">
                        <textarea id="editor"></textarea>
                    </div>
                    <div id="preview" class="span6">
                    </div>
                </div>
                <div class="btn-group">
                    <a class="btn" onclick="preview();">Preview</a>
                </div>
            </div>
        </div>
        <script type="text/javascript" src="lib/jquery-2.0.2.js"></script>
        <script type="text/javascript" src="lib/underscore.js"></script>
        <script type="text/javascript" src="lib/backbone.js"></script>
        <script type="text/javascript" src="lib/bootstrap.js"></script>
        <script type="text/javascript" src="lib/js-markdown-extra.js"></script>
        <script type="text/javascript">
            $('#editor').on("input change",function(){
                preview();
            });
            function preview(){
                $('#preview').html(Markdown($('#editor').val()));
            }
            $(document).ready(function() {
                jQuery.event.props.push('dataTransfer');
                $('#editor').bind('drop', function(evt) {
                    console.log("drop here");
                    var files = evt.dataTransfer.files;
                    $.each(files, function(index, file) {
                        if (!file.type.match('image.*')) {
                            alert("Sorry, but we only support images now!");
                            //Display Error Message 
                        }
                        var fileReader = new FileReader();
                        fileReader.onload = (function(file) {
                            return function(e) { 
                                $.post('/upload', {name: file.name, content: e.target.result}, function(data) {
                                    var result = $.parseJSON(data);
                                    $("#editor").val($("#editor").val() + " !["+ file.name + "](" + result.url + ") ");
                                    $("#editor").change();
                                });
                            }
                        })(file);
                        fileReader.readAsDataURL(file);
                    });
                    return false;
                });
            });
        </script>
    </body>
</html>
